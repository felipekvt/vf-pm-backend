import { Router } from 'express';import { prisma } from '../db';import { auth } from '../index';const r=Router();r.post('/',auth,async(req:any,res)=>{const {sensorId,value,ts}=req.body||{};if(!sensorId||value===undefined)return res.status(400).json({error:'sensorId e value obrigatórios'});const sensor=await prisma.sensor.findUnique({where:{id:sensorId}});if(!sensor||sensor.orgId!==req.orgId)return res.status(404).json({error:'sensor not found'});const reading=await prisma.reading.create({data:{sensorId,value,ts,orgId:req.orgId}});if(sensor.hi!==null&&sensor.hi!==undefined&&value>sensor.hi){const anyUser=await prisma.membership.findFirst({where:{orgId:req.orgId}});if(anyUser){await prisma.workOrder.create({data:{orgId:req.orgId,assetId:sensor.assetId,title:`Alerta ${sensor.kind}: ${value} ${sensor.unit} > hi ${sensor.hi}`,description:'Abertura automática por limite excedido',createdById:anyUser.userId}});}}res.status(201).json(reading);});export default r;